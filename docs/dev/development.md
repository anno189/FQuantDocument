# 开发须知

## 检查项目

- 年度：更新QADate_trade交易日历。
- 半年：指数指标股变更。
- 日常：概念的变更。

## 基本分类及特殊的问题

### 索引

- **每个新建数据表的索引！！！**

### 除权除息分类

1: 除权除息, 2: 送配股上市, 3: 非流通股上市, 4: 未知股本变动,5: 股本变化,6: 增发新股, 7: 股份回购, 8: 增发新股上市, 9: 转配股上市,10: 可转债上市,11: 扩缩股, 12: 非流通股缩股, 13: 送认购权证, 14: 送认沽权证

### stock_day

#### 取数

停盘日，会存在一条记录，O/C/H/W 为上日收盘价格, V/A 为最小浮点数。从数据库直接取数需过滤掉数据。条件：vol > 1

#### 涨停

涨停运算不考虑 ST

1. 暂时无法获取历史 ST。
2. 交易中不参与 ST 的交易。

### 复权

#### 运算

- 复权需要考虑复权参数，价格，总股本和流通股
- 历史换手率使用流通股，可流通股只能从财务报告体现，与交易软件相比，会存在滞后性。
  - 暂时不考虑可流通股，只使用流通股运算换手率。
  - 使用财务报告可能出现通达信服务器数据的滞后性，同时增加复权运算难度。
  - 目前可流通股Z使用百分位方式动态运算，日常交易中使用流通股运算。(2024.03)

### Data_Factor 数据的使用

- 价格为前复权价格，运算市值时候需要使用复权数据。 values / adj
- 每日需要根据财务信息重新运算xdxr 变化的标的。

### 港股及外盘

- 通达信港股数据会延迟15分钟，是否需要替换数据源
  - HSI取数，从 sina 或者 yahoo（通达信实盘滞后15分钟）
  -  https://stock.finance.sina.com.cn/hkstock/api/openapi.php/HK_StockService.getHKMinline?symbol=HSI&random=1644907014972&callback=var%20t1hkHSI=

### 已知可能存在的问题

- stock_info 中会漏掉某一日的数据（通达信服务器取数问题），无法修复问题，在初始化读取时候打过滤补丁。
- 部分票的可流通换手率存在错误，疑似财务数据出现问题，或者可流通股复权导致的问题
- stock_adj 在运算中会漏掉当前某一天的数据，（原因不明，可能会导致运算错误）
- 部分票的涨停计算存在问题：因为四舍五入的问题，导致相差1分钱，可能的原因为先复权在运算涨跌停。

## 服务器数据

- 近端次新(880885)，从服务器拉数据回来，数据存在问题。目前不影响后期运算。
- 竞价数据 9:15 ~ 9:25 已不可获取，9:27分钟，通过 realtime取集合竞价结果数据。
- 北交所代码不能从通达信获取，暂时从北交所官网获取